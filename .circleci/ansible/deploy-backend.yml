---

- name: "configuration play." 
  hosts: web
  user: ubuntu
  gather_facts: false
  vars:
    - ansible_python_interpreter: /usr/bin/python3
    - ansible_host_key_checking: false
    - ansible_stdout_callback: yaml

  tasks:
    - name: copy backend files to server
      become: true
      copy:
          src: ~/project/artifact.tar.gz
          dest: /home/ubuntu/artifact.tar.gz
    - name: start npm
      shell: |
        cd /home/ubuntu
        tar -xzvf artifact.tar.gz -C .
        sudo npm install
        sudo npm run build
        sudo pm2 stop default
        sudo pm2 start npm --name 'udaproject' -- start
  roles:
    - deploy
